<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
    <title>Add support to refresh tokens</title>
    <link rel="stylesheet" type="text/css" href="./res/styles/normalize.css">
    <link rel="stylesheet" type="text/css" href="./res/styles/prettify.css" />
    <link rel="stylesheet" type="text/css" href="./res/styles/styles.css">
</head>

<body>
    <!-- Use the same title as the StartHere -->
    <header>Authentication with Azure App Services</header>

    <section id="main">

        <h1 id="page-title"></h1>

        <h2>Duration</h2>
        <p>5 minutes</p>

        <h2>Goals</h2>
        <p>
            In this demonstration, we will walk through changes made to our MyDiary Xamarin.Forms application to support refresh tokens.
        </p>

        <h2>Assets</h2>
        <p>
            There is a completed version of the exercise in the <b>Part 03 Resources</b> folder.
        </p>

        <h2>Changes</h2>
        <p>
        You can explore the completed project on your own - changes are marked with comments prefaced with <b>Lab3:</b>; here are the relevant changes made to the application to support refresh tokens - compare it to the prior exercise's Completed solution to get a full delta.
        </p>
        <ol>
            <li>To support re-authentication, a new "logout" button has been added to the toolbar for the <b>DiaryEntryPage.xaml</b> file. This button activates a new <code>Command</code> which has been added in the <code>MainViewModel.cs</code> file that calls a new <code>LogoffAsync</code> method added to the Azure service access code in <b>AzureDiaryService.cs</b>.</li>
            <li>The <code>LoginAsync</code> code in the <b>AzureDiaryService.cs</b> source file has been rewritten to support checking for an expired token and then calling the <code>RefreshUserAsync</code> method to refresh the token.</li>
            <li>A new helper method has been added to the <b>AzureDiaryService.cs</b> source file to break the JWT apart and get the expiration date.</li>
            <li>Finally, the code now uses Microsoft as the Identity Provider as it's one of the three providers that supports token refreshing.</li>
        </ol>

        <div class="align-right">
            <a href="../Start%20Here.html">Go Back</a>
        </div>
    </section>

    <script src="./res/js/jquery.min.js"></script>
    <script src="./res/js/prettify.js"></script>
    <script src="./res/js/script.js"></script>

    <footer>Copyright (C) 2017 Xamarin</footer>
</body>
</html>
